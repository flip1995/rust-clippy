// run-rustfix

#![warn(clippy::iter_kv_map)]
#![allow(clippy::redundant_clone)]
#![allow(clippy::suspicious_map)]

use std::collections::{BTreeMap, HashMap};

fn main() {
    let get_key = |(key, _val)| key;

    let map: HashMap<u32, u32> = HashMap::new();

    let _ = map.keys().collect::<Vec<_>>();
    let _ = map.values().collect::<Vec<_>>();
    let _ = map.values().map(|v| v + 2).collect::<Vec<_>>();
    let _ = map.values().map(|val| {val}).collect::<Vec<_>>();

    let _ = map.clone().into_keys().collect::<Vec<_>>();
    let _ = map.clone().into_keys().map(|key| key + 2).collect::<Vec<_>>();

    let _ = map.clone().into_values().collect::<Vec<_>>();
    let _ = map.clone().into_values().map(|val| val + 2).collect::<Vec<_>>();

    let _ = map.clone().values().collect::<Vec<_>>();
    map.keys().filter(|x| *x % 2 == 0).count();

    // Don't lint
    map.iter().filter(|(_, val)| *val % 2 == 0).map(|(key, _)| key).count();
    map.iter().map(get_key).collect::<Vec<_>>();

    // Linting the following could be an improvement to the lint
    // map.iter().filter_map(|(_, val)| (val % 2 == 0).then(val * 17)).count();

    // Lint
    map.keys().map(|key| key * 9).count();
    map.values().map(|value| value * 17).count();

    let map: BTreeMap<u32, u32> = BTreeMap::new();

    let _ = map.keys().collect::<Vec<_>>();
    let _ = map.values().collect::<Vec<_>>();
    let _ = map.values().map(|v| v + 2).collect::<Vec<_>>();
    let _ = map.values().map(|val| {val}).collect::<Vec<_>>();

    let _ = map.clone().into_keys().collect::<Vec<_>>();
    let _ = map.clone().into_keys().map(|key| key + 2).collect::<Vec<_>>();

    let _ = map.clone().into_values().collect::<Vec<_>>();
    let _ = map.clone().into_values().map(|val| val + 2).collect::<Vec<_>>();

    let _ = map.clone().values().collect::<Vec<_>>();
    map.keys().filter(|x| *x % 2 == 0).count();

    // Don't lint
    map.iter().filter(|(_, val)| *val % 2 == 0).map(|(key, _)| key).count();
    map.iter().map(get_key).collect::<Vec<_>>();

    // Linting the following could be an improvement to the lint
    // map.iter().filter_map(|(_, val)| (val % 2 == 0).then(val * 17)).count();

    // Lint
    map.keys().map(|key| key * 9).count();
    map.values().map(|value| value * 17).count();
}
